angular.module("jnGrid",[]),angular.module("jnGrid").run(["$templateCache","$sce",function(e,t){"use strict";e.put("jnGrid.html",t.trustAsHtml('<table><thead><tr class="jnHeaderRow"><th jn-grid-header ng-repeat="column in options.columns"></th></tr></thead><tbody><tr jn-grid-row ng-class="{ jnRowEven: $even, jnRowOdd: $odd }"ng-repeat="row in dataset | orderBy:sortCol:sortDir"></tr></tbody></table>'))}]),angular.module("jnGrid").factory("syncService",[function(){function e(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.send(null),t.responseText}return{get:e}}]).filter("jnfilter",["$filter",function(e){return function(t,o){if(o){var n=o.split(/:\s/),r=e(n.shift());return n.unshift(t),r.apply(null,n)}return t}}]),angular.module("jnGrid").directive("jnGridCell",[function(){return{restrict:"EA",requires:"jnGrid",replace:!0,scope:{value:"=",filter:"@?"},template:"<td>{{ value | jnfilter: filter }}</td>"}}]),angular.module("jnGrid").directive("jnGrid",["$compile","$templateCache","syncService",function(e,t,o){function n(e){var n=o.get(e);return t.put(e,n),n}function r(o){if(o.options.accordionUrl&&(o.options.accordion=t.get(o.options.accordionUrl)||n(o.options.accordionUrl)),o.options.accordion){var r=angular.element("<td>"+o.options.accordion+"</td>");r.addClass("jnAccordion"),r.attr("colspan",o.options.columns.length+(o.options.enableCheckbox?1:0)),r.attr("ng-class","{ jnRowEven: $even, jnRowOdd: $odd }"),r.attr("ng-show","row.show"),o.options.accordion=e(r)}}function i(e){for(var t in l){var o=l[t];(void 0===e.options[o.property]||null===e.options[o.property])&&(e.options[o.property]=o.default)}}function s(e){var t=["$$hashKey","clicked","show"];if(e.dataset&&e.dataset.length>0&&!e.options.columns){e.options.columns=[];var o=Object.keys(e.dataset[0]);for(var n in o){var r=o[n];-1===t.indexOf(r)&&e.options.columns.push({field:r})}}}var l=[{property:"enableRowSelection","default":!0},{property:"selectByCheckboxOnly","default":!1},{property:"enableCheckbox","default":!1},{property:"multiSelect","default":!1}];return{restrict:"A",scope:{dataset:"=",options:"=?"},templateUrl:"jnGrid.html",link:function(e){e.options=e.options||{},i(e),e.options.selected={},e.options.selected.rows=[],e.options.columns||e.$watch("dataset",function(){s(e)}),s(e),r(e)}}}]),angular.module("jnGrid").directive("jnGridHeader",[function(){return{restrict:"A",requires:"jnGrid",replace:!0,template:"<th class=\"jnHeader th-{{ $parent.$id }} {{ column.sortable ? 'clickable' : '' }}\" ng-click=\"clickFn()\">{{ column.displayName || column.field }}</th>",link:function(e,t){e.$first&&e.options.enableCheckbox&&t.parent().prepend("<th></th>"),e.clickFn=function(){if(e.column.sortable){if(e.$parent.sortCol===e.column.field)e.$parent.sortDir=!e.$parent.sortDir;else{var o=".th-"+e.$parent.$id+".sorted";angular.element(document.querySelector(o)).removeClass("sorted"),t.addClass("sorted"),e.$parent.sortCol=e.column.field,e.$parent.sortDir=!1}t.removeClass("sort-"+!e.$parent.sortDir),t.addClass("sort-"+e.$parent.sortDir)}}}}}]),angular.module("jnGrid").directive("jnGridRow",["$compile","$rootScope",function(e){function t(e,t,o){var n;return o&&o(e,function(e){n=e,t.after(e),t.addClass("clickable")}),n}function o(t,o){var n=t.options.columns;t.options.enableCheckbox&&o.append(e('<td style="width:1em; padding:0.5em;"><input type="checkbox" ng-click="selectRow(true, $event)"/></td>')(t));for(var r in n)o.append(e('<div jn-grid-cell value="row.'+n[r].field+'" filter="'+(n[r].filter?n[r].filter:"")+'"></div>')(t))}var n=function(e,t,o){function n(){var n=t[0].querySelector('input[type="checkbox"]');if(e.options.multiSelect)e.options.selected.rows.push(e.row);else{e.options.selected.rows[0]=e.row;var r=t.parent();if(angular.element(r[0].querySelector("jn-grid-row.selected")).removeClass("selected"),angular.element(r[0].querySelector(".jnAccordion.selected")).removeClass("selected"),n){checkboxes=r[0].querySelectorAll('input[type="checkbox"]');for(i in checkboxes)checkboxes[i]!==n&&(checkboxes[i].checked=!1)}}t.addClass("selected"),n&&n.checked===!1&&(n.checked=!0),o&&o.addClass("selected"),e.options.selected.item=e.row,e.$emit("jnRowSelect",e.options.id,e.row)}function r(){if(e.options.multiSelect){var n=e.options.selected.rows.indexOf(e.row);n>-1&&e.options.selected.rows.splice(n,1)}else e.options.selected.rows[0]=void 0;t.removeClass("selected"),o&&o.removeClass("selected"),e.options.selected.item=void 0,e.$emit("jnRowDeselect",e.options.id,e.row)}return{selectFn:function(t,i){t===!0&&i.stopPropagation(),e.options.enableRowSelection&&(e.options.selectByCheckboxOnly&&t!==!0||(e.options.selected.rows.indexOf(e.row)>-1?r(t):n(t))),o&&(e.options.showAccordionFn?e.options.showAccordionFn(e.row):e.row.show=!e.row.show,setTimeout(function(){e.$apply()},0))}}};return{restrict:"A",requires:"jnGrid",link:function(e,r){var i=e.row;i.show=!1,e.$watch("dataset",function(){o(e,r)});var s=t(e,r,e.options.accordion);e.selectRow=n(e,r,s).selectFn,r.bind("click",e.selectRow)}}}]);