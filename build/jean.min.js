angular.module("jnGrid",[]).factory("syncService",[function(){function e(e){var o=new XMLHttpRequest;return o.open("GET",e,!1),o.send(null),o.responseText}return{get:e}}]).directive("jnGridCell",[function(){return{restrict:"EA",requires:"jnGrid",replace:!0,scope:{value:"="},template:"<td>{{ value }}</td>"}}]).directive("jnGridHeader",[function(){return{restrict:"EA",requires:"jnGrid",replace:!0,template:"<th class=\"jnHeader th-{{ $parent.$id }} {{ column.sortable ? 'clickable' : '' }}\" ng-click=\"clickFn()\">{{ column.displayName || column.field }}</th>",link:function(e,o){e.clickFn=function(){if(e.column.sortable){if(e.$parent.sortCol===e.column.field)e.$parent.sortDir=!e.$parent.sortDir;else{var n=".th-"+e.$parent.$id+".sorted";angular.element(document.querySelector(n)).removeClass("sorted"),o.addClass("sorted"),e.$parent.sortCol=e.column.field,e.$parent.sortDir=!1}o.removeClass("sort-"+!e.$parent.sortDir),o.addClass("sort-"+e.$parent.sortDir)}}}}}]).directive("jnGridRow",["$compile","$rootScope",function(e){function o(e,o,t){var r;t&&t(e,function(e){r=e,o.after(e),o.addClass("clickable")}),o.bind("click",function(){n(e,o,r)})}function n(e,o,n){function t(){e.options.multiSelect?e.options.selected.rows.push(e.row):(e.options.selected.rows[0]=e.row,angular.element(document.querySelector("jn-grid-row.selected")).removeClass("selected"),angular.element(document.querySelector(".jnAccordion.selected")).removeClass("selected")),o.addClass("selected"),n&&n.addClass("selected"),e.options.selected.item=e.row,e.$emit("jnRowSelect",e.options.id)}function r(){if(e.options.multiSelect){var t=e.options.selected.rows.indexOf(e.row);t>-1&&e.options.selected.rows.splice(t,1)}else e.options.selected.rows[0]=void 0;o.removeClass("selected"),n&&n.removeClass("selected"),e.options.selected.item=void 0,e.$emit("jnRowDeselect",e.options.id)}e.options.enableRowSelection&&(e.options.selected.rows.indexOf(e.row)>-1?r():t()),n&&(e.options.rowClickedFn?e.options.rowClickedFn(e.row):e.row.show=!e.row.show,e.$apply())}function t(o,n){var t=o.options.columns;for(var r in t)n.append(e('<div jn-grid-cell value="row.'+t[r].field+'"></div>')(o))}return{restrict:"EA",requires:"jnGrid",link:function(e,n){var r=e.row;r.show=!1,t(e,n),o(e,n,e.options.accordion)}}}]).directive("jnGrid",["$compile","$templateCache","syncService",function(e,o,n){function t(e){var t=n.get(e);return o.put(e,t),t}function r(n){if(n.options.accordionUrl&&(n.options.accordion=o.get(n.options.accordionUrl)||t(n.options.accordionUrl)),n.options.accordion){var r=angular.element("<td>"+n.options.accordion+"</td>");r.addClass("jnAccordion"),r.attr("colspan",n.options.columns.length),r.attr("ng-class","{ jnRowEven: $even, jnRowOdd: $odd }"),r.attr("ng-show","row.show"),n.options.accordion=e(r)}}function i(e){var o=["$$hashKey","clicked"];if(!e.options.columns){e.options.columns=[];var n=Object.keys(e.dataset[0]);for(var t in n){var r=n[t];-1===o.indexOf(r)&&e.options.columns.push({field:r})}}}return{restrict:"EA",scope:{dataset:"=",options:"=?"},template:'<tr><jn-grid-header ng-repeat="column in options.columns"></jn-grid-header></tr><jn-grid-row ng-class="{ jnRowEven: $even,  jnRowOdd: $odd }"ng-repeat="row in dataset | orderBy:sortCol:sortDir"></jn-grid-row>',link:function(e){e.options=e.options||{},void 0===e.options.enableRowSelection&&(e.options.enableRowSelection=!0),e.options.selected={},e.options.selected.rows=[],i(e),r(e)}}}]);