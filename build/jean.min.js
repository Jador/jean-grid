angular.module("jnGrid",[]),angular.module("jnGrid").run(["$templateCache",function(e){e.put("jnGrid.html",'<table><tr><jn-grid-header ng-repeat="column in options.columns"></jn-grid-header></tr><jn-grid-row ng-class="{ jnRowEven: $even, jnRowOdd: $odd }"ng-repeat="row in dataset | orderBy:sortCol:sortDir"></jn-grid-row></table>')}]),angular.module("jnGrid").factory("syncService",[function(){function e(e){var o=new XMLHttpRequest;return o.open("GET",e,!1),o.send(null),o.responseText}return{get:e}}]).filter("jnfilter",["$filter",function(e){return function(o,t){if(t){var n=t.split(/:\s/),r=e(n.shift());return n.unshift(o),r.apply(null,n)}return o}}]),angular.module("jnGrid").directive("jnGridCell",[function(){return{restrict:"EA",requires:"jnGrid",replace:!0,scope:{value:"=",filter:"@?"},template:"<td>{{ value | jnfilter: filter }}</td>"}}]),angular.module("jnGrid").directive("jnGrid",["$compile","$templateCache","syncService",function(e,o,t){function n(e){var n=t.get(e);return o.put(e,n),n}function r(t){if(t.options.accordionUrl&&(t.options.accordion=o.get(t.options.accordionUrl)||n(t.options.accordionUrl)),t.options.accordion){var r=angular.element("<td>"+t.options.accordion+"</td>");r.addClass("jnAccordion"),r.attr("colspan",t.options.columns.length+(t.options.enableCheckbox?1:0)),r.attr("ng-class","{ jnRowEven: $even, jnRowOdd: $odd }"),r.attr("ng-show","row.show"),t.options.accordion=e(r)}}function i(e){for(var o in s){var t=s[o];(void 0===e.options[t.property]||null===e.options[t.property])&&(e.options[t.property]=t.default)}}function l(e){var o=["$$hashKey","clicked","show"];if(e.dataset&&e.dataset.length>0&&!e.options.columns){e.options.columns=[];var t=Object.keys(e.dataset[0]);for(var n in t){var r=t[n];-1===o.indexOf(r)&&e.options.columns.push({field:r})}}}var s=[{property:"enableRowSelection","default":!0},{property:"selectByCheckboxOnly","default":!1},{property:"enableCheckbox","default":!1},{property:"multiSelect","default":!1}];return{restrict:"EA",scope:{dataset:"=",options:"=?"},templateUrl:"jnGrid.html",link:function(e){e.options=e.options||{},i(e),e.options.selected={},e.options.selected.rows=[],e.options.columns||e.$watch("dataset",function(){l(e)}),l(e),r(e)}}}]),angular.module("jnGrid").directive("jnGridHeader",[function(){return{restrict:"EA",requires:"jnGrid",replace:!0,template:"<th class=\"jnHeader th-{{ $parent.$id }} {{ column.sortable ? 'clickable' : '' }}\" ng-click=\"clickFn()\">{{ column.displayName || column.field }}</th>",link:function(e,o){e.$first&&e.options.enableCheckbox&&o.parent().prepend("<th></th>"),e.clickFn=function(){if(e.column.sortable){if(e.$parent.sortCol===e.column.field)e.$parent.sortDir=!e.$parent.sortDir;else{var t=".th-"+e.$parent.$id+".sorted";angular.element(document.querySelector(t)).removeClass("sorted"),o.addClass("sorted"),e.$parent.sortCol=e.column.field,e.$parent.sortDir=!1}o.removeClass("sort-"+!e.$parent.sortDir),o.addClass("sort-"+e.$parent.sortDir)}}}}}]),angular.module("jnGrid").directive("jnGridRow",["$compile","$rootScope",function(e){function o(e,o,t){var n;return t&&t(e,function(e){n=e,o.after(e),o.addClass("clickable")}),n}function t(o,t){var n=o.options.columns;o.options.enableCheckbox&&t.append(e('<td style="width:1em; padding:0.5em;"><input type="checkbox" ng-click="selectRow(true, $event)"/></td>')(o));for(var r in n)t.append(e('<div jn-grid-cell value="row.'+n[r].field+'" filter="'+(n[r].filter?n[r].filter:"")+'"></div>')(o))}var n=function(e,o,t){function n(){var n=o[0].querySelector('input[type="checkbox"]');if(e.options.multiSelect)e.options.selected.rows.push(e.row);else{e.options.selected.rows[0]=e.row;var r=o.parent();if(angular.element(r[0].querySelector("jn-grid-row.selected")).removeClass("selected"),angular.element(r[0].querySelector(".jnAccordion.selected")).removeClass("selected"),n){checkboxes=r[0].querySelectorAll('input[type="checkbox"]');for(i in checkboxes)checkboxes[i]!==n&&(checkboxes[i].checked=!1)}}o.addClass("selected"),n&&n.checked===!1&&(n.checked=!0),t&&t.addClass("selected"),e.options.selected.item=e.row,e.$emit("jnRowSelect",e.options.id,e.row)}function r(){if(e.options.multiSelect){var n=e.options.selected.rows.indexOf(e.row);n>-1&&e.options.selected.rows.splice(n,1)}else e.options.selected.rows[0]=void 0;o.removeClass("selected"),t&&t.removeClass("selected"),e.options.selected.item=void 0,e.$emit("jnRowDeselect",e.options.id,e.row)}return{selectFn:function(o,i){o===!0&&i.stopPropagation(),e.options.enableRowSelection&&(e.options.selectByCheckboxOnly&&o!==!0||(e.options.selected.rows.indexOf(e.row)>-1?r(o):n(o))),t&&(e.options.showAccordionFn?e.options.showAccordionFn(e.row):e.row.show=!e.row.show,setTimeout(function(){e.$apply()},0))}}};return{restrict:"EA",requires:"jnGrid",link:function(e,r){var i=e.row;i.show=!1,e.$watch("dataset",function(){t(e,r)});var l=o(e,r,e.options.accordion);e.selectRow=n(e,r,l).selectFn,r.bind("click",e.selectRow)}}}]);